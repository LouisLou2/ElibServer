<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.leo.elib.mapper.ReserveBorrowMapper">

    <resultMap id="ReserveBorrowBriefMap" type="ReserveBorrowBrief" autoMapping="true">
        <id property="reserveId" column="reserve_id"/>
        <result property="status" column="status"/>
        <result property="reservedTime" column="reserve_time"/>
        <result property="pickUpDeadline" column="deadline"/>
        <result property="dueTime" column="due_time"/>
        <result property="coverMUrl" column="cover_m_url"/>
    </resultMap>

    <select id="getBriefsByUserId" resultMap="ReserveBorrowBriefMap">
        SELECT r.reserve_id,
               r.status,
               bi.title,
               bi.isbn,
               r.reserve_time,
               r.deadline,
               r.due_time,
               bi.cover_m_url
        from reservation r
        inner join book_info bi on r.isbn = bi.isbn
        where r.user_id = #{userId}
          <if test="status != null">
            and r.status = #{status}
          </if>
        order by r.reserve_time desc
        limit #{num} offset #{offset}
    </select>

</mapper>